<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Megaplan – Building Regulations 2025 Compliance Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #050816;
      --bg-soft: #0b1020;
      --bg-card: #10172f;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --accent-strong: #0ea5e9;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border-subtle: #1f2937;
      --danger: #f97373;
      --success: #4ade80;
      --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.9);
      --radius-xl: 24px;
      --radius-lg: 16px;
      --radius-pill: 999px;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      margin: 0;
      font-family: var(--font-sans);
      background: radial-gradient(circle at top, #020617 0, #020617 30%, #020617 55%, #020617 100%);
      color: var(--text);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
    }

    .page {
      max-width: 1200px;
      width: 100%;
      background: radial-gradient(circle at top left, #0b1120, #020617 55%, #020617);
      border-radius: 32px;
      border: 1px solid rgba(148, 163, 184, 0.15);
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
    }

    /* Top bar */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px 10px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.65));
      backdrop-filter: blur(18px);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0%, #38bdf8 0, #0ea5e9 35%, #1d4ed8 80%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 40px rgba(56, 189, 248, 0.6);
      position: relative;
      overflow: hidden;
    }

    .brand-logo::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, 0.3);
    }

    .brand-logo span {
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 0.04em;
      color: #e5f3ff;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-name {
      font-weight: 600;
      font-size: 16px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .brand-tagline {
      font-size: 12px;
      color: var(--muted);
    }

    .topbar-pill {
      padding: 6px 14px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(56, 189, 248, 0.3);
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.2), rgba(15, 23, 42, 0.9));
      font-size: 11px;
      color: #e0f2fe;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .topbar-pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 14px rgba(34, 197, 94, 0.9);
    }

    /* Layout */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 24px;
      padding: 16px 22px 20px;
    }

    @media (max-width: 900px) {
      body {
        padding: 12px;
      }

      .page {
        border-radius: 20px;
      }

      .layout {
        grid-template-columns: minmax(0, 1fr);
        padding: 12px 16px 16px;
      }

      .topbar {
        padding: 12px 16px 10px;
      }
    }

    /* Left column (content) */
    .left {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .hero-heading {
      font-size: 22px;
      line-height: 1.25;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-heading span.primary {
      font-weight: 700;
      color: #f9fafb;
    }

    .hero-heading span.sub {
      font-size: 13px;
      font-weight: 500;
      color: var(--muted);
      max-width: 470px;
    }

    .hero-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 2px;
    }

    .hero-chip {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.12), rgba(15, 23, 42, 0.9));
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .hero-chip-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 10px;
      color: var(--muted);
    }

    /* Bullet feature card */
    .feature-card {
      border-radius: var(--radius-xl);
      border: 1px solid rgba(148, 163, 184, 0.18);
      background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.16), rgba(15, 23, 42, 0.98));
      padding: 14px 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .feature-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .feature-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #e5f3ff;
    }

    .feature-pill {
      font-size: 10px;
      padding: 4px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
      background: rgba(15, 23, 42, 0.8);
    }

    .feature-list {
      list-style: none;
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 4px;
      font-size: 12px;
      color: #e5e7eb;
    }

    .feature-list li {
      display: flex;
      gap: 8px;
      align-items: flex-start;
      line-height: 1.4;
    }

    .feature-bullet {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: #a5f3fc;
      flex-shrink: 0;
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.35), transparent 70%);
    }

    .feature-aim {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* Journey cards */
    .journey-wrapper {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 10px;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .journey-wrapper {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .journey, .side-notes {
      border-radius: var(--radius-lg);
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 10px 12px;
    }

    .journey-title,
    .side-title {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .journey-steps {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 11px;
    }

    .step-row {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 8px;
      align-items: flex-start;
    }

    .step-number {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #e5e7eb;
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.35), rgba(15, 23, 42, 0.95));
      flex-shrink: 0;
    }

    .step-body {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .step-title {
      font-weight: 500;
      color: #e5e7eb;
    }

    .step-desc {
      color: var(--muted);
    }

    .side-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 11px;
    }

    .side-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .side-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.9);
      flex-shrink: 0;
    }

    .role-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .role-pill {
      font-size: 10px;
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: #e5e7eb;
    }

    /* Right column (chatbot) */
    .right {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .viewing-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--muted);
    }

    .role-toggle {
      display: inline-flex;
      padding: 2px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
      gap: 2px;
    }

    .role-toggle span {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 10px;
      cursor: default;
      white-space: nowrap;
    }

    .role-toggle span.active {
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.35), rgba(15, 23, 42, 0.9));
      color: #e0f2fe;
      border: 1px solid rgba(56, 189, 248, 0.7);
    }

    .role-toggle span.muted {
      color: var(--muted);
    }

    .chat-card {
      border-radius: var(--radius-xl);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), rgba(15, 23, 42, 1));
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 12px 12px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    .chat-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .chat-title-main {
      font-size: 13px;
      font-weight: 600;
      color: #e5f3ff;
    }

    .chat-title-sub {
      color: var(--muted);
    }

    .chip-outline {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 10px;
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.85);
    }

    .chip-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      box-shadow: 0 0 12px rgba(74, 222, 128, 0.8);
    }

    .chat-body {
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 8px 10px 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 330px;
      overflow: hidden;
    }

    .chat-scroll {
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .chat-msg {
      display: flex;
      gap: 8px;
      font-size: 11px;
      line-height: 1.4;
    }

    .chat-avatar {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      flex-shrink: 0;
    }

    .avatar-bot {
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.4), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(56, 189, 248, 0.8);
      color: #e0f2fe;
    }

    .avatar-user {
      background: rgba(15, 23, 42, 1);
      border: 1px solid rgba(75, 85, 99, 1);
      color: #e5e7eb;
    }

    .chat-bubble {
      padding: 7px 9px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 1);
      border: 1px solid rgba(55, 65, 81, 0.95);
      color: #e5e7eb;
      flex: 1;
      white-space: pre-wrap;
    }

    .chat-bubble.bot {
      background: rgba(15, 23, 42, 0.95);
      border-color: rgba(56, 189, 248, 0.4);
    }

    .chat-bubble p + p {
      margin-top: 4px;
    }

    .chat-bubble strong {
      color: #e0f2fe;
      font-weight: 600;
    }

    .chat-tags {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .tag-pill {
      font-size: 9px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      color: #cbd5f5;
    }

    .chat-footer {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 10px;
      color: var(--muted);
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 6px 8px;
    }

    .input-field {
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
      font-size: 11px;
      flex: 1;
    }

    .input-field::placeholder {
      color: rgba(148, 163, 184, 0.9);
    }

    .input-button {
      border: none;
      outline: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 10px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: radial-gradient(circle at 0 0, #38bdf8, #0ea5e9);
      color: #0b1020;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.55);
      white-space: nowrap;
    }

    .input-button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .input-helper {
      font-size: 10px;
      color: var(--muted);
    }

    .input-helper span {
      color: #e5e7eb;
    }

    /* footer */
    .footer {
      padding: 6px 22px 12px;
      border-top: 1px solid rgba(15, 23, 42, 0.9);
      font-size: 10px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    @media (max-width: 900px) {
      .footer {
        padding: 6px 16px 12px;
        flex-direction: column;
        align-items: flex-start;
      }
    }

    .footer span strong {
      color: #e5e7eb;
    }

    .footer span.highlight {
      color: #a5f3fc;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Top Bar -->
    <header class="topbar">
      <div class="brand">
        <div class="brand-logo">
          <span>M</span>
        </div>
        <div class="brand-text">
          <div class="brand-name">Megaplan</div>
          <div class="brand-tagline">
            Interactive Compliance Platform for 2025 Building Regulations
          </div>
        </div>
      </div>
      <div class="topbar-pill">
        <span class="topbar-pill-dot"></span>
        <span>AI Compliance Assistant &bull; Parts B, F, L &amp; O</span>
      </div>
    </header>

    <!-- Main Layout -->
    <main class="layout">
      <!-- LEFT: Product Content -->
      <section class="left">
        <div class="hero-heading">
          <span class="primary">Navigate 2025 Building Regulations with confidence.</span>
          <span class="sub">
            This prototype supports construction professionals working under the
            <strong>2025 Building Regulations</strong> and the
            <strong>Building Safety Act 2022</strong>, combining structured tools and an AI-guided Q&amp;A assistant.
          </span>
          <div class="hero-chip-row">
            <div class="hero-chip">
              <span class="hero-chip-label">Scope</span>
              <span>Parts B, F, L &amp; O</span>
            </div>
            <div class="hero-chip">
              <span class="hero-chip-label">User Types</span>
              <span>Guest, Contractor, Admin</span>
            </div>
            <div class="hero-chip">
              <span class="hero-chip-label">Output</span>
              <span>Court-ready compliance summaries</span>
            </div>
          </div>
        </div>

        <!-- Feature bullets -->
        <article class="feature-card">
          <div class="feature-title-row">
            <div class="feature-title">Compliance content strategy</div>
            <div class="feature-pill">Position Megaplan as a trusted voice</div>
          </div>
          <ul class="feature-list">
            <li>
              <div class="feature-bullet">✓</div>
              <div>Updates on <strong>Building Regulations 2025</strong> and related guidance.</div>
            </li>
            <li>
              <div class="feature-bullet">✓</div>
              <div>Case studies of <strong>successful compliance strategies</strong>.</div>
            </li>
            <li>
              <div class="feature-bullet">✓</div>
              <div>Practical tips for architects &amp; contractors (e.g. “Top 5 ventilation pitfalls in refurbishments”).</div>
            </li>
            <li>
              <div class="feature-bullet">✓</div>
              <div>Occasional industry news &amp; Megaplan updates to reinforce authority.</div>
            </li>
          </ul>
          <div class="feature-aim">
            The aim is to position Megaplan as a <strong>trusted expert in compliance and regulation</strong>, not just another tool.
          </div>
        </article>

        <!-- Journey + Side notes -->
        <div class="journey-wrapper">
          <section class="journey">
            <div class="journey-title">High-level compliance journey</div>
            <div class="journey-steps">
              <div class="step-row">
                <div class="step-number">1</div>
                <div class="step-body">
                  <div class="step-title">Capture project context</div>
                  <div class="step-desc">
                    Collect project type, height, use class and applicable regulation parts.
                  </div>
                </div>
              </div>
              <div class="step-row">
                <div class="step-number">2</div>
                <div class="step-body">
                  <div class="step-title">Guided Q&amp;A assistant</div>
                  <div class="step-desc">
                    Walk through duty holder responsibilities &amp; technical questions with structured prompts.
                  </div>
                </div>
              </div>
              <div class="step-row">
                <div class="step-number">3</div>
                <div class="step-body">
                  <div class="step-title">Automatic risk highlighting</div>
                  <div class="step-desc">
                    Identify missing information or high-risk elements to reduce non-compliance.
                  </div>
                </div>
              </div>
              <div class="step-row">
                <div class="step-number">4</div>
                <div class="step-body">
                  <div class="step-title">Court-ready summary</div>
                  <div class="step-desc">
                    Generate a structured compliance document ready for review and email.
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="side-notes">
            <div class="side-title">Interface principles</div>
            <div class="side-list">
              <div class="side-item">
                <div class="side-dot"></div>
                <div><strong>Hybrid interface</strong>: experts jump into structured menus; others follow the guided wizard.</div>
              </div>
              <div class="side-item">
                <div class="side-dot"></div>
                <div><strong>Role-aware views</strong>: guests see examples, contractors manage live projects, admins see organisation-wide activity.</div>
              </div>
              <div class="side-item">
                <div class="side-dot"></div>
                <div><strong>Audit-friendly</strong>: every form is structured so a backend can log and retrieve it for future audits.</div>
              </div>
            </div>

            <div class="role-pill-row">
              <div class="role-pill">Viewing as guest / client</div>
              <div class="role-pill">Contractor mode</div>
              <div class="role-pill">Admin analytics</div>
            </div>
          </section>
        </div>
      </section>

      <!-- RIGHT: Chatbot Panel -->
      <section class="right">
        <div class="viewing-row">
          <span>Viewing as <strong>Guest / Client</strong></span>
          <div class="role-toggle">
            <span class="active">Guest</span>
            <span class="muted">Contractor</span>
            <span class="muted">Admin</span>
          </div>
        </div>

        <section class="chat-card">
          <header class="chat-header">
            <div class="chat-title">
              <div class="chat-title-main">Megaplan Regulations Assistant</div>
              <div class="chat-title-sub">
                Acts as a Building Regulations expert for 2025 rules and the Building Safety Act 2022.
              </div>
            </div>
            <div class="chip-outline">
              <span class="chip-dot"></span>
              <span>AI-powered &bull; Live via Gemini</span>
            </div>
          </header>

          <div class="chat-body">
            <div class="chat-scroll" id="chatScroll">
              <!-- Initial Bot welcome -->
              <div class="chat-msg">
                <div class="chat-avatar avatar-bot">M</div>
                <div class="chat-bubble bot">
                  <p><strong>Welcome to Megaplan.</strong> I’m your Building Regulations 2025 assistant.</p>
                  <p>
                    Ask me about <strong>Parts B, F, L and O</strong>, refurbishment pitfalls, compliance
                    strategies, or how the <strong>Building Safety Act 2022</strong> affects your project.
                  </p>
                  <div class="chat-tags">
                    <span class="tag-pill">Updates on 2025 regulations</span>
                    <span class="tag-pill">Case studies &amp; strategies</span>
                    <span class="tag-pill">Ventilation &amp; overheating</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Input area -->
          <div class="chat-footer">
            <div class="input-row">
              <input
                id="userInput"
                type="text"
                class="input-field"
                placeholder="Ask about Parts B, F, L, O or a specific refurbishment scenario…"
              />
              <button class="input-button" id="sendButton" type="button">
                Ask Megaplan
              </button>
            </div>
            <div class="input-helper">
              The assistant is tuned to act as a <span>Building Regulations expert</span> for UK projects under the
              <span>2025 Regulations</span> and <span>Building Safety Act 2022</span>.
            </div>
          </div>
        </section>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <span>
        This UI runs purely in the browser and calls the <strong>Gemini API</strong> for expert-style answers.
      </span>
      <span>
        <span class="highlight">Megaplan</span> &mdash; Building Regulations &amp; Building Safety Act compliance,
        made explainable.
      </span>
    </footer>
  </div>

  <script>
    // ==== CONFIG – PASTE YOUR GEMINI KEY HERE ====
    const GEMINI_API_KEY = "YOUR_GEMINI_API_KEY_HERE";
    const GEMINI_MODEL = "gemini-1.5-flash";

    const chatScroll = document.getElementById("chatScroll");
    const userInput = document.getElementById("userInput");
    const sendButton = document.getElementById("sendButton");

    const conversationHistory = [];

    function appendMessage(role, text, isThinking = false) {
      const msg = document.createElement("div");
      msg.className = "chat-msg";

      const avatar = document.createElement("div");
      avatar.className = "chat-avatar " + (role === "bot" ? "avatar-bot" : "avatar-user");
      avatar.textContent = role === "bot" ? "M" : "U";

      const bubble = document.createElement("div");
      bubble.className = "chat-bubble" + (role === "bot" ? " bot" : "");
      bubble.textContent = text;

      msg.appendChild(avatar);
      msg.appendChild(bubble);
      chatScroll.appendChild(msg);
      chatScroll.scrollTop = chatScroll.scrollHeight;

      if (isThinking) {
        bubble.dataset.thinking = "true";
      }

      return bubble;
    }

    async function callGeminiAPI(prompt) {
      const systemInstruction = `
You are "Megaplan", an expert assistant on UK Building Regulations 2025 and the Building Safety Act 2022.

Focus on:
- Parts B (fire safety), F (ventilation), L (conservation of fuel and power) and O (overheating).
- Updates on 2025 regulations and related guidance.
- Case studies and practical, real-world compliance strategies.
- Practical tips for architects and contractors, e.g. "Top 5 ventilation pitfalls in refurbishments".
- Occasional industry context to position Megaplan as a trusted voice, but keep answers focused and actionable.

Style:
- Be concise, structured and professional.
- Use UK terminology.
- Clearly highlight risks, duties and where users should check official guidance or consult a qualified professional.
`;

      const historyText = conversationHistory
        .map(h => (h.role === "user" ? "User: " : "Megaplan: ") + h.text)
        .join("\n");

      const fullPrompt = `${systemInstruction}\n\nConversation so far:\n${historyText}\n\nUser: ${prompt}\n\nMegaplan:`;

      const body = {
        contents: [
          {
            role: "user",
            parts: [{ text: fullPrompt }]
          }
        ]
      };

      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${encodeURIComponent(
          GEMINI_API_KEY
        )}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        }
      );

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error("Gemini API error: " + errorText);
      }

      const data = await response.json();
      const candidate = data.candidates && data.candidates[0];
      if (
        !candidate ||
        !candidate.content ||
        !candidate.content.parts ||
        !candidate.content.parts.length
      ) {
        throw new Error("No response from Gemini");
      }

      return candidate.content.parts.map(p => p.text || "").join("\n");
    }

    async function handleSend() {
      const text = userInput.value.trim();
      if (!text) return;

      if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE") {
        alert("Please insert your Gemini API key in the code (GEMINI_API_KEY).");
        return;
      }

      appendMessage("user", text);
      conversationHistory.push({ role: "user", text });

      userInput.value = "";
      userInput.focus();
      sendButton.disabled = true;

      const thinkingBubble = appendMessage("bot", "Thinking about your compliance question…", true);

      try {
        const answer = await callGeminiAPI(text);
        thinkingBubble.textContent = answer;
        delete thinkingBubble.dataset.thinking;
        conversationHistory.push({ role: "bot", text: answer });
      } catch (err) {
        thinkingBubble.textContent =
          "Sorry, I couldn't contact the regulations engine right now.\n\nDetails: " +
          err.message;
        thinkingBubble.style.borderColor = "#f97373";
        thinkingBubble.style.color = "#fecaca";
      } finally {
        sendButton.disabled = false;
        chatScroll.scrollTop = chatScroll.scrollHeight;
      }
    }

    sendButton.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSend();
      }
    });
  </script>
</body>
</html>
